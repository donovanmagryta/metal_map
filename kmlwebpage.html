<!DOCTYPE html>
<html>
<body>
<button onclick="getLocation()">Test GPS</button>
<p id="demo"></p>
<textarea rows="4" cols="50">Typing an exclamation point marks current location.</textarea>
  <button title = "download map" onclick="download_kml()">download kml file</button>

<script>
let detectedlog = "";
var x = document.getElementById("demo");
  document.addEventListener("keydown", function (zEvent) {
   if (zEvent.key === "!") {
    //getLocation();
     x.innerHTML = "detected";
    detectedlog += "\n";
    detectedlog += "<Placemark><Point><coordinates>"+lat+", "+long+", 0.</coordinates></Point></Placemark>";
    detectedlog += "\n";
//dataa.push([lat]); 
     console.log("lat LOGGED");
//dataa.push([long]); 
     console.log("long LOGGED");
x.innerHTML = "detected";
    console.log(detectedlog);    
    }
});

  
  
function getLocation() {
  if (navigator.geolocation) {
    //navigator.geolocation.getCurrentPosition(showPosition);
     navigator.geolocation.watchPosition(showPosition);
  } else { 
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function showPosition(position) {
  x.innerHTML = "Latitude: " + position.coords.latitude + 
  "<br>Longitude: " + position.coords.longitude;
lat = position.coords.latitude.toPrecision(5);
long = position.coords.longitude.toPrecision(5);
}






function download_kml() {
    var kml = "<?xml version=\"1.0\" encoding=\"UTF-8\"?\><kml xmlns=\"http:\/\/earth.google.com/kml/2.0\"> <Document\>";
    kml += detectedlog;
    kml += "</Document></kml>";


   console.log(kml);
    var hiddenElement = document.createElement('a');
    hiddenElement.href = 'data:text/kml;charset=utf-8,' + encodeURI(kml);
    hiddenElement.target = '_blank';
    filename = "map.kml";
    hiddenElement.download = filename;
    hiddenElement.click();
}
</script>
</body>
</html>
